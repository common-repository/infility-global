"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _regeneratorRuntime(){_regeneratorRuntime=function(){return o};var l,o={},e=Object.prototype,c=e.hasOwnProperty,u=Object.defineProperty||function(e,t,n){e[t]=n.value},t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",n=t.asyncIterator||"@@asyncIterator",a=t.toStringTag||"@@toStringTag";function i(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{i({},"")}catch(l){i=function(e,t,n){return e[t]=n}}function s(e,t,n,r){var a,i,o,s,t=t&&t.prototype instanceof w?t:w,t=Object.create(t.prototype),r=new q(r||[]);return u(t,"_invoke",{value:(a=e,i=n,o=r,s=d,function(e,t){if(s===g)throw new Error("Generator is already running");if(s===m){if("throw"===e)throw t;return{value:l,done:!0}}for(o.method=e,o.arg=t;;){var n=o.delegate;if(n){n=function e(t,n){var r=n.method,a=t.iterator[r];if(a===l)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=l,e(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;r=p(a,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,h;a=r.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,h):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}(n,o);if(n){if(n===h)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(s===d)throw s=m,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s=g;n=p(a,i,o);if("normal"===n.type){if(s=o.done?m:f,n.arg===h)continue;return{value:n.arg,done:o.done}}"throw"===n.type&&(s=m,o.method="throw",o.arg=n.arg)}})}),t}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}o.wrap=s;var d="suspendedStart",f="suspendedYield",g="executing",m="completed",h={};function w(){}function v(){}function y(){}var t={},$=(i(t,r,function(){return this}),Object.getPrototypeOf),$=$&&$($(T([]))),b=($&&$!==e&&c.call($,r)&&(t=$),y.prototype=w.prototype=Object.create(t));function _(e){["next","throw","return"].forEach(function(t){i(e,t,function(e){return this._invoke(t,e)})})}function x(o,s){var t;u(this,"_invoke",{value:function(n,r){function e(){return new s(function(e,t){!function t(e,n,r,a){var i,e=p(o[e],o,n);if("throw"!==e.type)return(n=(i=e.arg).value)&&"object"==_typeof(n)&&c.call(n,"__await")?s.resolve(n.__await).then(function(e){t("next",e,r,a)},function(e){t("throw",e,r,a)}):s.resolve(n).then(function(e){i.value=e,r(i)},function(e){return t("throw",e,r,a)});a(e.arg)}(n,r,e,t)})}return t=t?t.then(e,e):e()}})}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function q(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function T(t){if(t||""===t){var n,e=t[r];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return n=-1,(e=function e(){for(;++n<t.length;)if(c.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=l,e.done=!0,e}).next=e}throw new TypeError(_typeof(t)+" is not iterable")}return u(b,"constructor",{value:v.prototype=y,configurable:!0}),u(y,"constructor",{value:v,configurable:!0}),v.displayName=i(y,a,"GeneratorFunction"),o.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},o.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,i(e,a,"GeneratorFunction")),e.prototype=Object.create(b),e},o.awrap=function(e){return{__await:e}},_(x.prototype),i(x.prototype,n,function(){return this}),o.AsyncIterator=x,o.async=function(e,t,n,r,a){void 0===a&&(a=Promise);var i=new x(s(e,t,n,r),a);return o.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},_(b),i(b,a,"Generator"),i(b,r,function(){return this}),i(b,"toString",function(){return"[object Generator]"}),o.keys=function(e){var t,n=Object(e),r=[];for(t in n)r.push(t);return r.reverse(),function e(){for(;r.length;){var t=r.pop();if(t in n)return e.value=t,e.done=!1,e}return e.done=!0,e}},o.values=T,q.prototype={constructor:q,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=l)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var r=this;function e(e,t){return i.type="throw",i.arg=n,r.next=e,t&&(r.method="next",r.arg=l),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var a=this.tryEntries[t],i=a.completion;if("root"===a.tryLoc)return e("end");if(a.tryLoc<=this.prev){var o=c.call(a,"catchLoc"),s=c.call(a,"finallyLoc");if(o&&s){if(this.prev<a.catchLoc)return e(a.catchLoc,!0);if(this.prev<a.finallyLoc)return e(a.finallyLoc)}else if(o){if(this.prev<a.catchLoc)return e(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return e(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&c.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}var i=(a=a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc?null:a)?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n,r,a=this.tryEntries[t];if(a.tryLoc===e)return"throw"===(n=a.completion).type&&(r=n.arg,I(a)),r}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:T(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=l),h}},o}function asyncGeneratorStep(e,t,n,r,a,i,o){try{var s=e[i](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,a)}function _asyncToGenerator(s){return function(){var e=this,o=arguments;return new Promise(function(t,n){var r=s.apply(e,o);function a(e){asyncGeneratorStep(r,t,n,a,i,"next",e)}function i(e){asyncGeneratorStep(r,t,n,a,i,"throw",e)}a(void 0)})}}!function(){function r(){var i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return i.action="infility_global_keyword_pages_ajax",i.ig_ts=(new Date).getTime(),new Promise(function(t,a){s.ajax({url:e,type:"POST",data:i,success:function(e){e.success?t(e.data):(console.log(e),a(new Error(e.data)))},error:function(e,t,n){console.log("[ajaxRequest] error - action: "+i.action+"\n\treadyState:"+e.readyState+"\n\tstatus:"+e.status+"\n\terrorThrown:"+n+"\n\ttextStatus:"+t+"\n",i);var r="Unknown error";4===e.readyState&&n?r=e.status+": "+n:n?r=n:t&&(r=t),a(new Error(r))}})})}var s,e=window.ajaxurl||"/wp-admin/admin-ajax.php",t=setInterval(function(){window.jQuery&&(clearInterval(t),(s=window.jQuery)(document).ready(i))},100),n={$scope:null,init:function(e){(n.$scope=e).find(".tab").on("click",function(){var e=s(this),t=e.closest(".tabs"),n=t.find(".panel"),r=n.eq(e.index());t.find(".tab").removeClass("active"),e.addClass("active"),n.removeClass("show"),r.addClass("show")}),e.find(".tab").eq(0).click()}},g={$editor:null,$wrap:null,$loading:null,$iptId:null,$iptParent:null,$iptKeyword:null,$iptDescription:null,$iptDescription2:null,$iptOrder:null,$iptTemplateSelect:null,$q1:null,$q2:null,$q3:null,$a1:null,$a2:null,$a3:null,$slug:null,$btnGenerateDescription2:null,$btnAiGenerateFaq:null,$btnSave:null,$btnCancel:null,callback:null,mainList:[],desc2Templates:["Introducing top-notch __KEYWORD__. Crafted to perfection, our __KEYWORD__ offer unmatched quality, and flexible customization options. With years of experience and supportive team members, we are obssessed with delivering perfect and tailored solutions for every client. Experience one-stop solution and 24/7 support from us.","Step into a world of exceptional quality and craftsmanship with our diverse range of __KEYWORD__. From manufacturing to private labeling & wholesaling, we pride ourselves on delivering products that exceed expectations. Don’t settle for ordinary – explore our __KEYWORD__collection today and indulge in the extraordinary.","Discover the epitome of __KEYWORD__ excellence! Our range of exquisite, high-quality __KEYWORD__ will elevate your game. Embrace the power of exceptional products and enhance your projects. Experience one-stop solution and 24/7 support from us. Discover our range now and revolutionize your product lines!","Unleash possibilities with our cutting-edge __KEYWORD__! Crafted with precision and ingenuity, our __KEYWORD__ blend quality, safety, and style seamlessly. Experience one-stop solution and 24/7 support from us. Empower your brand and business with our advanced  technology & craftsmanship—explore our range today and reclaim uninterrupted power!"],init:function(e){g.$editor=e.find(".keyword-editor"),g.$wrap=e.find(".keyword-editor-wrap"),g.$loading=g.$wrap.find(".loading"),g.$iptId=g.$wrap.find(".ipt-id"),g.$iptParent=g.$wrap.find(".ipt-parent"),g.$iptKeyword=g.$wrap.find(".ipt-keyword"),g.$iptDescription=g.$wrap.find(".ipt-description"),g.$iptDescription2=g.$wrap.find(".ipt-description2"),g.$iptOrder=g.$wrap.find(".ipt-order"),g.$q1=g.$wrap.find(".ipt-q1"),g.$q2=g.$wrap.find(".ipt-q2"),g.$q3=g.$wrap.find(".ipt-q3"),g.$a1=g.$wrap.find(".ipt-a1"),g.$a2=g.$wrap.find(".ipt-a2"),g.$a3=g.$wrap.find(".ipt-a3"),g.$slug=g.$wrap.find(".slug"),g.$iptTemplateSelect=g.$wrap.find(".ipt-template-select"),g.$btnGenerateDescription2=g.$wrap.find(".btn-generate-description-2"),g.$btnAiGenerateFaq=g.$wrap.find(".btn-ai-generate-faq"),g.$btnSave=g.$wrap.find(".btn-save"),g.$btnCancel=g.$wrap.find(".btn-cancel"),g.$iptKeyword.on("keyup",g.onKeywordChanged),g.$btnCancel.on("click",g.hide),g.$btnSave.on("click",g.save),g.$wrap.find(".btn-generate-what-is").on("click",g.generateWhatIs),g.$btnGenerateDescription2.on("click",g.onGenerateDescription2Clicked),g.$btnAiGenerateFaq.on("click",g.generateFAQ)},showLoading:function(){g.$loading.addClass("show")},hideLoading:function(){g.$loading.removeClass("show")},recoverText:function(e){return e.replace(/\\"/g,'"').replace(/\\'/g,"'")},showFaq:function(e,t,n){return(e=e||[])[t]||(e[t]={}),e[t][n]||(e[t][n]=""),g.recoverText(e[t][n])},show:function(e,t){g.callback=t,g.$iptId.val(e.id||"0"),g.$iptKeyword.val(e.keyword||""),g.$iptDescription.val(g.recoverText(e.description||"")),g.$iptDescription2.val(g.recoverText(e.description2||"")),g.$iptOrder.val(e.order||"0"),g.$iptTemplateSelect.val("-1"),g.$q1.val(g.showFaq(e.faq,0,"question")),g.$q2.val(g.showFaq(e.faq,1,"question")),g.$q3.val(g.showFaq(e.faq,2,"question")),g.$a1.val(g.showFaq(e.faq,0,"answer")),g.$a2.val(g.showFaq(e.faq,1,"answer")),g.$a3.val(g.showFaq(e.faq,2,"answer")),g.$wrap.find(".span-loading-1").html(""),g.$wrap.find(".span-loading-2").html("通常需要 30 秒以上，请耐心等待。"),g.onKeywordChanged(),g.updateSelect(),g.$iptParent.val(e.parent||"0"),g.$editor.addClass("show"),setTimeout(function(){g.$wrap.addClass("show")},10)},hide:function(){g.$wrap.removeClass("show"),setTimeout(function(){g.$editor.removeClass("show")},300)},onKeywordChanged:function(){g.$slug.html(g.generateSlug(g.$iptKeyword.val())),g.$wrap.find("span.keyword").html(g.$iptKeyword.val())},updateSelect:function(){var t='<option value="0">(None)</option>';g.mainList.forEach(function(e){e.id!==parseInt(g.$iptId.val())&&(t+='<option value="'+e.id+'">'+e.keyword+"</option>")}),g.$iptParent.html(t)},generateSlug:function(e){return e.toLowerCase().replace(/&/g,"and").replace(/\s/g,"-")},onGenerateDescription2Clicked:function(){var e=parseInt(g.$iptTemplateSelect.val()),e=g.generateDescription2(e,g.$iptKeyword.val());0<g.$iptDescription2.val().length&&!confirm("Are you sure to overwrite the description?")||g.$iptDescription2.val(e)},generateDescription2:function(e,t){return e=parseInt(e),(isNaN(e)||e<0||e>=g.desc2Templates.length)&&(e=Math.floor(Math.random()*g.desc2Templates.length)),g.desc2Templates[e].replace(/__KEYWORD__/g,t)},save:function(){return _asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n,r,a,i,o,s,l,c,u,p,d,f;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=g.$iptId.val(),n=parseInt(g.$iptParent.val()),r=g.$iptKeyword.val(),a=g.$iptDescription.val(),i=g.$iptDescription2.val(),o=parseInt(g.$iptOrder.val()),s=g.$wrap.find(".ipt-q1").val(),l=g.$wrap.find(".ipt-q2").val(),c=g.$wrap.find(".ipt-q3").val(),u=g.$wrap.find(".ipt-a1").val(),p=g.$wrap.find(".ipt-a2").val(),d=g.$wrap.find(".ipt-a3").val(),0===r.length)return alert("Please enter keyword"),e.abrupt("return");e.next=15;break;case 15:if(0===a.length)return alert('Please enter description for "what is"'),e.abrupt("return");e.next=18;break;case 18:if(0===i.length)return alert('Please enter description for "'+r+' by xxx"'),e.abrupt("return");e.next=21;break;case 21:if(r.replace(/[^a-zA-Z0-9\-_& ]/g,"")!==r)return alert("Keyword 仅支持 a-z A-Z 0-9 中横线 下划线 & 以及空格"),e.abrupt("return");e.next=25;break;case 25:if(g.callback)return g.showLoading(),f=g.generateSlug(r),e.prev=28,f={id:t,parent:n,keyword:r,slug:f,description:a,description2:i,order:o,faq:[{question:s,answer:u},{question:l,answer:p},{question:c,answer:d}]},e.next=32,g.callback(f);e.next=43;break;case 32:g.hide(),e.next=38;break;case 35:e.prev=35,e.t0=e.catch(28),alert(e.t0.message);case 38:return e.prev=38,g.hideLoading(),e.finish(38);case 41:e.next=44;break;case 43:g.hide();case 44:case"end":return e.stop()}},e,null,[[28,35,38,41]])}))()},generateWhatIs:function(){return _asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n,r;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0===(t=g.$iptKeyword.val()).length)return alert("Please enter keyword"),e.abrupt("return");e.next=4;break;case 4:if(!(0<g.$iptDescription.val().length)){e.next=8;break}if(confirm("生成的内容将覆盖现有内容，是否继续?")){e.next=8;break}return e.abrupt("return");case 8:return n=(new Date).getTime(),g.$wrap.find(".span-loading-1").html("Loading..."),e.prev=10,e.next=13,g.generateFromAI("whatis",t);case 13:r=e.sent,g.$iptDescription.val(r),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(10),setTimeout(function(){alert(e.t0.message)},1);case 20:return e.prev=20,r=Math.floor(((new Date).getTime()-n)/1e3),g.$wrap.find(".span-loading-1").html("Done. 用了 "+r+" 秒"),e.finish(20);case 24:case"end":return e.stop()}},e,null,[[10,17,20,24]])}))()},generateFAQ:function(){return _asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n,r,a,i;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return g.$wrap.find(".span-loading-2").html("Loading..."),t=(new Date).getTime(),e.prev=2,e.next=5,g.generateFromAI("faq",g.$iptKeyword.val());case 5:for(i=e.sent,n=JSON.parse(i),r=0;r<n.length;r++)a=n[r],g.$wrap.find(".ipt-q"+(r+1)).val(a.question),g.$wrap.find(".ipt-a"+(r+1)).val(a.answer);e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),setTimeout(function(){alert(e.t0.message)},1);case 13:return e.prev=13,i=Math.floor(((new Date).getTime()-t)/1e3),g.$wrap.find(".span-loading-2").html("Done. 用了 "+i+" 秒"),e.finish(13);case 17:case"end":return e.stop()}},e,null,[[2,10,13,17]])}))()},generateFromAI:function(e,t){return r({do_action:"openai_text",keyword:t,type:e})}},l={$scope:null,$wrap:null,$iptParent:null,$domLog:null,$btnRefresh:null,$btnImport:null,init:function(e){l.$scope=e,l.$wrap=e.find(".panel-import"),l.$iptParent=l.$wrap.find(".ipt-parent"),l.$domLog=l.$wrap.find(".div-log tbody"),l.$btnImport=l.$wrap.find(".btn-import"),l.$btnRefresh=l.$wrap.find(".btn-refresh-main-list"),l.$wrap.find(".btn-cancel").on("click",l.hide),l.$wrap.find(".btn-import").on("click",l.import),l.$btnRefresh.on("click",l.refreshMainList)},import:function(){return _asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n,r,a;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.$iptParent.val()){e.next=4;break}return alert("Please select parent keyword1"),e.abrupt("return");case 4:t=parseInt(t),n=l.$wrap.find("textarea").val(),n=n.split("\n"),l.$btnImport.attr("disabled",!0),e.prev=8,r=0;case 10:if(!(r<n.length)){e.next=29;break}if(a=n[r]){e.next=14;break}return e.abrupt("continue",26);case 14:if(a=a.trim()){e.next=17;break}return e.abrupt("continue",26);case 17:return e.next=19,l.checkKeywordExists(a);case 19:if(e.sent)return l.addLog("error","keyword exists: "+a),e.abrupt("continue",26);e.next=23;break;case 23:return e.next=25,l.importOne(a,t);case 25:l.addLog("debug","----");case 26:r++,e.next=10;break;case 29:l.addLog("info","DONE"),e.next=35;break;case 32:e.prev=32,e.t0=e.catch(8),alert(e.t0.message);case 35:l.$btnImport.attr("disabled",!1);case 36:case"end":return e.stop()}},e,null,[[8,32]])}))()},importOne:function(o,s){return _asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n,r,a,i;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l.addLog("info","* START: "+o),l.addLog("debug","parent: "+s),t=g.generateSlug(o),l.addLog("debug","slug: "+t),e.prev=4,e.next=7,Promise.all([l.generateWhatIs(o),l.generateFAQ(o)]);case 7:n=e.sent,e.next=15;break;case 10:return e.prev=10,e.t0=e.catch(4),alert(e.t0.message),l.addLog("error","ERROR: "+e.t0.message),e.abrupt("return");case 15:return console.log(n),i=n[0],r=n[1],r=JSON.parse(r),a=g.generateDescription2(-1,o),i={id:0,parent:s,keyword:o,slug:t,description:i,description2:a,order:0,faq:[{question:r[0].question,answer:r[0].answer},{question:r[1].question,answer:r[1].answer},{question:r[2].question,answer:r[2].answer}]},console.log(i),e.prev=22,l.addLog("debug","adding: "+o),e.next=26,u.saveKeyword("add",i);case 26:n=e.sent,l.addLog("info","keyword added: "+o),e.next=35;break;case 30:return e.prev=30,e.t1=e.catch(22),alert(e.t1.message),l.addLog("error","ERROR: "+e.t1.message),e.abrupt("return");case 35:console.log(n);case 36:case"end":return e.stop()}},e,null,[[4,10],[22,30]])}))()},refreshMainList:function(){var t=l.$wrap.find("select");t.html(""),u.getMainKeywordList().forEach(function(e){t.append('<option value="'+e.id+'">'+e.keyword+"</option>")})},addLog:function(e,t){e='<tr class="'+e+'"><td>['+(new Date).toLocaleString()+"]</td><td>"+t+"</td></tr>";l.$domLog.append(e)},generateWhatIs:function(n){return _asyncToGenerator(_regeneratorRuntime().mark(function e(){var t;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l.addLog("debug","AI generate - start: what is "+n),e.next=3,g.generateFromAI("whatis",n);case 3:return t=e.sent,l.addLog("debug","AI generate - done: what is "+n),e.abrupt("return",t);case 6:case"end":return e.stop()}},e)}))()},generateFAQ:function(n){return _asyncToGenerator(_regeneratorRuntime().mark(function e(){var t;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l.addLog("debug","AI generate - START: faq for "+n),e.next=3,g.generateFromAI("faq",n);case 3:return t=e.sent,l.addLog("debug","AI generate - DONE: faq for "+n),e.abrupt("return",t);case 6:case"end":return e.stop()}},e)}))()},checkKeywordExists:function(n){return _asyncToGenerator(_regeneratorRuntime().mark(function e(){var t;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r({do_action:"keyword_exists",keyword:n});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}},e)}))()}},c={$scope:null,$wrap:null,$iptImageUrl:null,$iptImageAlt:null,$iptTitle:null,$iptDesc:null,template:"",list:[],init:function(t){return _asyncToGenerator(_regeneratorRuntime().mark(function e(){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c.$scope=t,c.$wrap=t.find(".panel-whyus"),c.$iptImageUrl=c.$wrap.find(".ipt-image-url"),c.$iptImageAlt=c.$wrap.find(".ipt-image-alt"),c.$iptTitle=c.$wrap.find(".ipt-title"),c.$iptDesc=c.$wrap.find(".ipt-desc"),c.template=c.$wrap.find("tbody").html(),c.$wrap.on("click",".btn-select-image-to-add",c.selectImageToAdd),c.$wrap.on("click",".btn-add",c.add),c.$wrap.on("click","td.image .btn-select-image",c.selectImage),c.$wrap.on("click","td.image .btn-delete-image",c.deleteImage),c.$wrap.on("click",".btn-save",c.saveItem),c.$wrap.on("click",".btn-delete",c.deleteItem),e.next=15,c.getList();case 15:c.list=e.sent,c.render();case 17:case"end":return e.stop()}},e)}))()},getList:function(){return _asyncToGenerator(_regeneratorRuntime().mark(function e(){var t;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r({do_action:"get_whyus_list"});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}},e)}))()},save:function(){return _asyncToGenerator(_regeneratorRuntime().mark(function e(){var t;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.list,e.prev=1,e.next=4,r({do_action:"save_whyus",data:t});case 4:t=e.sent,c.list=t,c.render(),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),alert(e.t0.message);case 12:case"end":return e.stop()}},e,null,[[1,9]])}))()},saveItem:function(){var o=this;return _asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n,r,a,i;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=s(o).closest("tr"),t=parseInt(a.find("td.index").html())-1,i=a.find("td.image img").attr("src"),n=a.find("td.alt input").val(),r=a.find("td.title input").val(),a=a.find("td.desc textarea").val(),i={image_url:i,image_alt:n,title:r,content:a},c.list[t]=i,e.next=10,c.save();case 10:case"end":return e.stop()}},e)}))()},deleteItem:function(){var n=this;return _asyncToGenerator(_regeneratorRuntime().mark(function e(){var t;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s(n).closest("tr"),t=parseInt(t.find("td.index").html())-1,confirm("Are you sure to delete this item?")){e.next=4;break}return e.abrupt("return");case 4:return c.list.splice(t,1),e.next=7,c.save();case 7:c.render();case 8:case"end":return e.stop()}},e)}))()},renderOne:function(e,t){var n=s(c.template);return n.find("td.index").html(e+1),n.find("td.image img").attr("src",t.image_url),n.find("td.image img").attr("alt",t.image_alt),n.find("td.alt input").val(t.image_alt),n.find("td.title input").val(t.title),n.find("td.desc textarea").val(t.content),n},render:function(){c.$wrap.find("tbody").html(""),c.list.forEach(function(e,t){c.$wrap.find("tbody").append(c.renderOne(t,e))})},selectImageToAdd:function(){var t=wp.media({title:"Select or Upload Image",button:{text:"Use this image"},multiple:!1}).open().on("select",function(){var e=t.state().get("selection").first().toJSON();c.$iptImageUrl.val(e.url),c.$iptImageAlt.val(e.alt),c.$wrap.find(".tr-add img").attr("src",e.url)})},add:function(){return _asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n,r,a;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=c.$iptImageUrl.val(),t=c.$iptImageAlt.val(),n=c.$iptTitle.val(),r=c.$iptDesc.val(),a={image_url:a,image_alt:t,title:n,content:r},c.list.push(a),e.next=8,c.save();case 8:c.render(),c.$iptImageUrl.val(""),c.$iptImageAlt.val(""),c.$iptTitle.val(""),c.$iptDesc.val(""),c.$wrap.find(".tr-add img").attr("src","");case 14:case"end":return e.stop()}},e)}))()},selectImage:function(){var e=s(this).closest("tr"),t=parseInt(e.find("td.index").html())-1,n=(console.log(t),wp.media({title:"Select or Upload Image",button:{text:"Use this image"},multiple:!1}).open().on("select",function(){var e=n.state().get("selection").first().toJSON();c.list[t].image_url=e.url,c.list[t].image_alt||(c.list[t].image_alt=e.alt),c.render()}))},deleteImage:function(){var e=s(this).closest("tr"),e=parseInt(e.find("td.index").html())-1;confirm("Are you sure to delete this image?")&&(c.list[e].image_url="",c.list[e].image_alt="",c.render())}},a={$scope:null,$wrap:null,$iptPostType:null,$iptTaxonomy:null,$iptBannerImage:null,$iptWhatisImage:null,$iptWhatisImageAlt:null,$iptFaqImage:null,$iptFaqImageAlt:null,$iptLink:null,$btnSelectBannerImage:null,$btnSelectWhatisImage:null,$btnSelectFaqImage:null,$btnSave:null,settings:{},postTypeList:[],taxonomyList:[],init:function(t){return _asyncToGenerator(_regeneratorRuntime().mark(function e(){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.$scope=t,a.$wrap=t.find(".panel-settings"),a.$iptPostType=a.$wrap.find(".ipt-post-type"),a.$iptTaxonomy=a.$wrap.find(".ipt-taxonomy"),a.$iptBannerImage=a.$wrap.find(".ipt-banner-image"),a.$iptWhatisImage=a.$wrap.find(".ipt-whatis-image"),a.$iptWhatisImageAlt=a.$wrap.find(".ipt-whatis-image-alt"),a.$iptFaqImage=a.$wrap.find(".ipt-faq-image"),a.$iptFaqImageAlt=a.$wrap.find(".ipt-faq-image-alt"),a.$iptLink=a.$wrap.find(".ipt-link"),a.$btnSelectBannerImage=a.$wrap.find(".btn-select-banner-image"),a.$btnSelectWhatisImage=a.$wrap.find(".btn-select-whatis-image"),a.$btnSelectFaqImage=a.$wrap.find(".btn-select-faq-image"),a.$btnSave=a.$wrap.find(".btn-save"),a.$iptPostType.on("change",a.onPostTypeChanged),a.$btnSelectBannerImage.on("click",a.selectBannerImage),a.$btnSelectWhatisImage.on("click",a.selectWhatisImage),a.$btnSelectFaqImage.on("click",a.selectFaqImage),a.$btnSave.on("click",a.saveSettings),e.prev=19,e.next=22,a.getSettings();case 22:a.settings=e.sent,a.postTypeList=a.settings.post_types,a.render(),e.next=30;break;case 27:e.prev=27,e.t0=e.catch(19),alert(e.t0.message);case 30:case"end":return e.stop()}},e,null,[[19,27]])}))()},getSettings:function(){return _asyncToGenerator(_regeneratorRuntime().mark(function e(){var t;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r({do_action:"get_settings"});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}},e)}))()},saveSettings:function(){return _asyncToGenerator(_regeneratorRuntime().mark(function e(){var t;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t={}).post_type=a.$iptPostType.val(),t.taxonomy=a.$iptTaxonomy.val(),t.banner_image=a.$iptBannerImage.val(),t.whatis_image=a.$iptWhatisImage.val(),t.whatis_image_alt=a.$iptWhatisImageAlt.val(),t.faq_image=a.$iptFaqImage.val(),t.faq_image_alt=a.$iptFaqImageAlt.val(),t.link=a.$iptLink.val(),e.prev=9,e.next=12,r({do_action:"save_settings",data:t});case 12:t=e.sent,alert("Saved"),a.settings=t.settings,a.render(),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(9),alert(e.t0.message);case 21:case"end":return e.stop()}},e,null,[[9,18]])}))()},render:function(){a.renderPostTypes(),a.$iptPostType.val(a.settings.post_type||""),a.onPostTypeChanged(),a.$iptTaxonomy.val(a.settings.taxonomy||""),a.$iptBannerImage.val(a.settings.banner_image||""),a.$iptWhatisImage.val(a.settings.whatis_image||""),a.$iptWhatisImageAlt.val(a.settings.whatis_image_alt||""),a.$iptFaqImage.val(a.settings.faq_image||""),a.$iptFaqImageAlt.val(a.settings.faq_image_alt||""),a.$iptLink.val(a.settings.link||"")},renderPostTypes:function(){var t='<option value="">Please select ...</option>';a.postTypeList.forEach(function(e){t+='<option value="'+e.value+'">'+e.label+"</option>"}),a.$iptPostType.html(t)},renderTaxonomies:function(){var t='<option value="">Please select ...</option>';a.taxonomyList.forEach(function(e){t+='<option value="'+e.value+'">'+e.label+"</option>"}),a.$iptTaxonomy.html(t)},onPostTypeChanged:function(){var t=a.$iptPostType.val(),e=a.postTypeList.find(function(e){return e.value===t});a.taxonomyList=e?e.taxonomies:[],a.renderTaxonomies()},selectBannerImage:function(){var t=wp.media({title:"Select or Upload Image",button:{text:"Use this image"},multiple:!1}).open().on("select",function(){var e=t.state().get("selection").first().toJSON();a.$iptBannerImage.val(e.url)})},selectWhatisImage:function(){var t=wp.media({title:"Select or Upload Image",button:{text:"Use this image"},multiple:!1}).open().on("select",function(){var e=t.state().get("selection").first().toJSON();a.$iptWhatisImage.val(e.url)})},selectFaqImage:function(){var t=wp.media({title:"Select or Upload Image",button:{text:"Use this image"},multiple:!1}).open().on("select",function(){var e=t.state().get("selection").first().toJSON();a.$iptFaqImage.val(e.url)})}},u={$scope:null,list:[],$btnAddKeyWord:null,$trTemplate:null,$panels:null,trTemplate:"",init:function(e){u.$scope=e,u.$btnAddKeyWord=e.find(".btn-add-keyword"),u.$btnAddKeyWord.on("click",u.addKeyword),u.$trTemplate=e.find(".tr-template"),u.$panels=e.find(".panel"),u.trTemplate=u.$trTemplate.html(),g.init(e),l.init(e),n.init(e),a.init(e),c.init(e),u.refresh()},refresh:function(){return _asyncToGenerator(_regeneratorRuntime().mark(function e(){var t;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.getKeywordList();case 3:t=e.sent,u.list=[],Object.keys(t).forEach(function(e){u.list.push(t[e])}),u.render(),e.next=16;break;case 10:return e.prev=10,e.t0=e.catch(0),u.$trTemplate.html('<tr><td colspan="100">Error: '+e.t0.message+"</td></tr>"),e.next=15,delay(1);case 15:alert(e.t0.message);case 16:case"end":return e.stop()}},e,null,[[0,10]])}))()},getKeywordList:function(){return r({do_action:"get_keyword_list"})},renderHtmlText:function(e){return e.replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/</g,"&lt;").replace(/>/g,"&gt;")},renderFaq:function(e,t,n){return(e=e||[])[t]||(e[t]={}),e[t][n]||(e[t][n]=""),u.renderHtmlText(e[t][n])},renderOne:function(t,e){var n,r=s(u.trTemplate);0===t.parent?(r.addClass("main-keyword"),r.find(".is_main_keyword").html("主词")):(r.addClass("sub-keyword"),(n=u.list.find(function(e){return e.id===t.parent}))?r.find(".is_main_keyword").html(n.keyword):r.find(".is_main_keyword").html("")),r.find(".keyword").html('<a href="/kwp/'+t.slug+'/" target="_blank" title="点击查看页面">'+t.keyword+"</a>"),r.find(".description").html(u.renderHtmlText(t.description||"")),r.find(".description2").html(u.renderHtmlText(t.description2||"")),r.find(".slug").html(t.slug),r.find(".q1").html(u.renderFaq(t.faq,0,"question")),r.find(".a1").html(u.renderFaq(t.faq,0,"answer")),r.find(".q2").html(u.renderFaq(t.faq,1,"question")),r.find(".a2").html(u.renderFaq(t.faq,1,"answer")),r.find(".q3").html(u.renderFaq(t.faq,2,"question")),r.find(".a3").html(u.renderFaq(t.faq,2,"answer")),r.find(".btn-edit").attr("data-index",e),r.find(".btn-edit").attr("data-id",t.id),r.find(".btn-delete").attr("data-index",e),r.find(".btn-delete").attr("data-id",t.id),r.find(".btn-edit").on("click",function(){u.onStartEdit(t)}),r.find(".btn-delete").on("click",function(){var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.onDeleteClicked(t.target);case 2:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()),u.$scope.find(".panel-list table tbody").append(r)},render:function(){u.list.sort(function(e,t){return e.order||(e.order=0),t.order||(t.order=0),t.order-e.order}),u.$scope.find(".panel-list table tbody").html(""),u.list.forEach(function(t){0===t.parent&&(u.renderOne(t),u.list.forEach(function(e){e.parent===t.id&&u.renderOne(e)}))}),g.mainList=u.getMainKeywordList()},getMainKeywordList:function(){var t=[];return u.list.forEach(function(e){0===e.parent&&t.push(e)}),t},addKeyword:function(){g.show({},function(){var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.saveKeyword("add",t);case 2:return e.next=4,u.refresh();case 4:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}())},onStartEdit:function(e){g.show(e,function(){var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.saveKeyword("one",t);case 2:return e.next=4,u.refresh();case 4:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}())},onDeleteClicked:function(r){return _asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=parseInt(s(r).attr("data-id")),n=u.list.find(function(e){return e.id===t})){e.next=5;break}return alert("Item not found"),e.abrupt("return");case 5:if(confirm("Are you sure?"))return e.prev=6,e.next=9,u.saveKeyword("del",n);e.next=16;break;case 9:return e.next=11,u.refresh();case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),alert(e.t0.message);case 16:case"end":return e.stop()}},e,null,[[6,13]])}))()},saveKeyword:function(e,t){return r({do_action:"save_keyword_list",save:e,data:t})}},i=function(){var e=s(".infility-global-keyword-pages");0<e.length&&u.init(e)}}();